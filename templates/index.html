{% extends "base.html" %}

{% block title %}Clovix - Download from YouTube, Instagram, Facebook{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-10 col-md-12">
        <!-- Platform Selection Tabs -->
        <div class="card mb-4">
            <div class="card-header">
                <h2 class="card-title mb-3">
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" class="me-2">
                        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none"/>
                        <path d="M8 12l4 4l4-4" stroke="currentColor" stroke-width="2" fill="none"/>
                    </svg>
                    Clovix
                </h2>
                <ul class="nav nav-tabs card-header-tabs" id="platform-tabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="youtube-tab" data-bs-toggle="tab" data-bs-target="#youtube-pane" type="button" role="tab">
                            <i class="fab fa-youtube text-danger me-2"></i>YouTube
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="instagram-tab" data-bs-toggle="tab" data-bs-target="#instagram-pane" type="button" role="tab">
                            <i class="fab fa-instagram text-primary me-2"></i>Instagram
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="facebook-tab" data-bs-toggle="tab" data-bs-target="#facebook-pane" type="button" role="tab">
                            <i class="fab fa-facebook text-info me-2"></i>Facebook
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="twitter-tab" data-bs-toggle="tab" data-bs-target="#twitter-pane" type="button" role="tab">
                            <i class="fab fa-twitter text-info me-2"></i>Twitter
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="tiktok-tab" data-bs-toggle="tab" data-bs-target="#tiktok-pane" type="button" role="tab">
                            <i class="fab fa-tiktok me-2"></i>TikTok
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="other-tab" data-bs-toggle="tab" data-bs-target="#other-pane" type="button" role="tab">
                            <i class="fas fa-globe me-2"></i>Other
                        </button>
                    </li>
                </ul>
            </div>
            <div class="card-body">
                <div class="tab-content" id="platform-tab-content">
                    <!-- YouTube Tab -->
                    <div class="tab-pane fade show active" id="youtube-pane" role="tabpanel">
                        <div class="platform-section">
                            <div class="d-flex align-items-center mb-3">
                                <i class="fab fa-youtube fa-2x text-danger me-3"></i>
                                <div>
                                    <h5 class="mb-0">YouTube</h5>
                                    <p class="text-muted mb-0">Download videos, shorts, and music from YouTube</p>
                                </div>
                            </div>
                            <form class="url-form" data-platform="youtube">
                                <div class="input-group">
                                    <span class="input-group-text d-none d-md-flex">
                                        <i class="fas fa-link"></i>
                                    </span>
                                    <input type="url" class="form-control video-url" 
                                           placeholder="Paste YouTube URL here...">
                                    <button class="btn btn-youtube analyze-btn" type="submit">
                                        <i class="fas fa-search me-1"></i><span class="d-none d-sm-inline">Analyze</span><span class="d-sm-none">Go</span>
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Instagram Tab -->
                    <div class="tab-pane fade" id="instagram-pane" role="tabpanel">
                        <div class="platform-section">
                            <div class="d-flex align-items-center mb-3">
                                <i class="fab fa-instagram fa-2x text-primary me-3"></i>
                                <div>
                                    <h5 class="mb-0">Instagram</h5>
                                    <p class="text-muted mb-0">Download posts, reels, stories, and IGTV videos</p>
                                </div>
                            </div>
                            <form class="url-form" data-platform="instagram">
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-link"></i>
                                    </span>
                                    <input type="url" class="form-control video-url" 
                                           placeholder="Paste Instagram URL here (e.g., https://instagram.com/p/...)">
                                    <button class="btn btn-instagram analyze-btn" type="submit">
                                        <i class="fas fa-search me-2"></i>Analyze
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Facebook Tab -->
                    <div class="tab-pane fade" id="facebook-pane" role="tabpanel">
                        <div class="platform-section">
                            <div class="d-flex align-items-center mb-3">
                                <i class="fab fa-facebook fa-2x text-info me-3"></i>
                                <div>
                                    <h5 class="mb-0">Facebook</h5>
                                    <p class="text-muted mb-0">Download videos from Facebook posts and pages</p>
                                </div>
                            </div>
                            <form class="url-form" data-platform="facebook">
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-link"></i>
                                    </span>
                                    <input type="url" class="form-control video-url" 
                                           placeholder="Paste Facebook URL here (e.g., https://facebook.com/...)">
                                    <button class="btn btn-facebook analyze-btn" type="submit">
                                        <i class="fas fa-search me-2"></i>Analyze
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Twitter Tab -->
                    <div class="tab-pane fade" id="twitter-pane" role="tabpanel">
                        <div class="platform-section">
                            <div class="d-flex align-items-center mb-3">
                                <i class="fab fa-twitter fa-2x text-info me-3"></i>
                                <div>
                                    <h5 class="mb-0">Twitter / X</h5>
                                    <p class="text-muted mb-0">Download videos and GIFs from Twitter posts</p>
                                </div>
                            </div>
                            <form class="url-form" data-platform="twitter">
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-link"></i>
                                    </span>
                                    <input type="url" class="form-control video-url" 
                                           placeholder="Paste Twitter URL here (e.g., https://twitter.com/...)">
                                    <button class="btn btn-twitter analyze-btn" type="submit">
                                        <i class="fas fa-search me-2"></i>Analyze
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- TikTok Tab -->
                    <div class="tab-pane fade" id="tiktok-pane" role="tabpanel">
                        <div class="platform-section">
                            <div class="d-flex align-items-center mb-3">
                                <i class="fab fa-tiktok fa-2x me-3"></i>
                                <div>
                                    <h5 class="mb-0">TikTok</h5>
                                    <p class="text-muted mb-0">Download TikTok videos without watermark</p>
                                </div>
                            </div>
                            <form class="url-form" data-platform="tiktok">
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-link"></i>
                                    </span>
                                    <input type="url" class="form-control video-url" 
                                           placeholder="Paste TikTok URL here (e.g., https://tiktok.com/@...)">
                                    <button class="btn btn-tiktok analyze-btn" type="submit">
                                        <i class="fas fa-search me-2"></i>Analyze
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Other Platforms Tab -->
                    <div class="tab-pane fade" id="other-pane" role="tabpanel">
                        <div class="platform-section">
                            <div class="d-flex align-items-center mb-3">
                                <i class="fas fa-globe fa-2x text-secondary me-3"></i>
                                <div>
                                    <h5 class="mb-0">Other Platforms</h5>
                                    <p class="text-muted mb-0">Vimeo, Dailymotion, and 1000+ other supported sites</p>
                                </div>
                            </div>
                            <form class="url-form" data-platform="other">
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-link"></i>
                                    </span>
                                    <input type="url" class="form-control video-url" 
                                           placeholder="Paste video URL from any supported platform...">
                                    <button class="btn btn-other analyze-btn" type="submit">
                                        <i class="fas fa-search me-2"></i>Analyze
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Loading Indicator -->
                <div id="loading" class="text-center py-4" style="display: none;">
                    <div class="spinner-border text-primary pulse" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2" style="color: rgba(255, 255, 255, 0.7);">Analyzing video...</p>
                </div>

                <!-- Error Display -->
                <div id="error-display" class="alert alert-danger" style="display: none;" role="alert">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <span id="error-message"></span>
                </div>

                <!-- Video Information -->
                <div id="video-info" style="display: none;">
                    <div class="row">
                        <div class="col-md-4">
                            <img id="video-thumbnail" class="img-fluid rounded floating" alt="Video Thumbnail">
                        </div>
                        <div class="col-md-8">
                            <h5 id="video-title" class="mb-2"></h5>
                            <p class="text-muted mb-1 small">
                                <i class="fas fa-user me-1"></i>
                                <span id="video-uploader"></span>
                            </p>
                            <p class="text-muted mb-2 small">
                                <i class="fas fa-clock me-1"></i>
                                <span id="video-duration"></span>
                                <span class="ms-2 d-none d-sm-inline">
                                    <i class="fas fa-eye me-1"></i>
                                    <span id="video-views"></span> views
                                </span>
                            </p>
                        </div>
                    </div>

                    <hr style="border-color: rgba(255, 255, 255, 0.2);">

                    <!-- Download Options -->
                    <div class="download-options">
                        <h5 style="color: white; margin-bottom: 1.5rem;">
                            <i class="fas fa-cog me-2"></i>
                            Download Options
                        </h5>
                        
                        <!-- Step 1: Format Selection -->
                        <div class="mb-4">
                            <h6 style="color: rgba(255, 255, 255, 0.9); margin-bottom: 1rem;">
                                <span class="badge bg-primary me-2">1</span>Choose Format Type
                            </h6>
                            <div class="row">
                                <div class="col-md-6 mb-2">
                                    <div class="simple-option" data-step="format" data-value="video">
                                        <i class="fas fa-video me-2"></i>Video
                                    </div>
                                </div>
                                <div class="col-md-6 mb-2">
                                    <div class="simple-option" data-step="format" data-value="audio">
                                        <i class="fas fa-music me-2"></i>Audio Only
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Step 2: Quality Selection -->
                        <div id="quality-section" style="display: none;" class="mb-4">
                            <h6 style="color: rgba(255, 255, 255, 0.9); margin-bottom: 1rem;">
                                <span class="badge bg-success me-2">2</span>Select Quality
                            </h6>
                            <div class="quality-simple-grid" id="quality-options">
                                <!-- Quality options will be populated here -->
                            </div>
                        </div>

                        <!-- Step 3: File Format Selection -->
                        <div id="file-format-section" style="display: none;" class="mb-4">
                            <h6 style="color: rgba(255, 255, 255, 0.9); margin-bottom: 1rem;">
                                <span class="badge bg-warning me-2">3</span>Choose File Format
                            </h6>
                            <div class="quality-simple-grid" id="file-format-options">
                                <!-- File format options will be populated here -->
                            </div>
                        </div>

                        <!-- Download Button -->
                        <div class="text-center mt-4">
                            <button class="btn btn-success btn-lg" id="download-btn" disabled>
                                <i class="fas fa-download me-2"></i>
                                Download Now
                            </button>
                            <div id="selection-status" class="mt-2" style="color: rgba(255, 255, 255, 0.6); font-size: 0.85rem;">
                                Complete all 3 steps above to enable download
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Download Progress -->
                <div id="download-progress" class="download-progress-container" style="display: none;">
                    <div class="download-progress-card">
                        <div class="download-progress-header">
                            <div class="download-progress-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" class="download-icon">
                                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none"/>
                                    <path d="M8 12l4 4l4-4" stroke="currentColor" stroke-width="2" fill="none"/>
                                </svg>
                            </div>
                            <h5 class="download-progress-title">Download Progress</h5>
                        </div>
                        
                        <div class="download-progress-content">
                            <div class="progress-container">
                                <div class="progress-bar-wrapper">
                                    <div class="progress-bar-track">
                                        <div class="progress-bar-fill" id="progress-bar" style="width: 0%">
                                            <div class="progress-bar-glow"></div>
                                        </div>
                                    </div>
                                    <div class="progress-percentage" id="progress-percentage">0%</div>
                                </div>
                            </div>
                            
                            <div class="download-status-container">
                                <div class="download-status-text" id="download-status">Preparing download...</div>
                                <div class="download-spinner">
                                    <div class="spinner"></div>
                                </div>
                            </div>
                            
                            <div id="download-complete" class="download-complete-container" style="display: none;">
                                <div class="download-success">
                                    <div class="success-icon">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                            <circle cx="12" cy="12" r="10" fill="#22c55e"/>
                                            <path d="M8 12l2 2 4-4" stroke="white" stroke-width="2" fill="none"/>
                                        </svg>
                                    </div>
                                    <div class="success-text">Download completed successfully!</div>
                                </div>
                                <a href="#" id="download-link" class="download-complete-btn">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                        <path d="M8 12l4 4l4-4" stroke="currentColor" stroke-width="2" fill="none"/>
                                        <path d="M12 2v10" stroke="currentColor" stroke-width="2" fill="none"/>
                                    </svg>
                                    Download File
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- Features Card -->
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-star me-2"></i>
                    Features & Capabilities
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="feature-item mb-3">
                            <i class="fas fa-video text-success me-3"></i>
                            <div>
                                <h6 style="color: white; margin-bottom: 0.5rem;">Multiple Video Formats</h6>
                                <p style="color: rgba(255, 255, 255, 0.7); margin: 0; font-size: 0.9rem;">
                                    MP4, WebM, 3GP, AVI, MKV and more
                                </p>
                            </div>
                        </div>
                        <div class="feature-item mb-3">
                            <i class="fas fa-music text-info me-3"></i>
                            <div>
                                <h6 style="color: white; margin-bottom: 0.5rem;">Audio Extraction</h6>
                                <p style="color: rgba(255, 255, 255, 0.7); margin: 0; font-size: 0.9rem;">
                                    MP3, M4A, OGG, WAV formats
                                </p>
                            </div>
                        </div>
                        <div class="feature-item mb-3">
                            <i class="fas fa-expand-arrows-alt text-warning me-3"></i>
                            <div>
                                <h6 style="color: white; margin-bottom: 0.5rem;">All Resolutions</h6>
                                <p style="color: rgba(255, 255, 255, 0.7); margin: 0; font-size: 0.9rem;">
                                    144p to 4K (2160p) and beyond
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="feature-item mb-3">
                            <i class="fas fa-bolt text-primary me-3"></i>
                            <div>
                                <h6 style="color: white; margin-bottom: 0.5rem;">Fast Downloads</h6>
                                <p style="color: rgba(255, 255, 255, 0.7); margin: 0; font-size: 0.9rem;">
                                    Optimized for maximum speed
                                </p>
                            </div>
                        </div>
                        <div class="feature-item mb-3">
                            <i class="fas fa-mobile-alt text-danger me-3"></i>
                            <div>
                                <h6 style="color: white; margin-bottom: 0.5rem;">Mobile Friendly</h6>
                                <p style="color: rgba(255, 255, 255, 0.7); margin: 0; font-size: 0.9rem;">
                                    Works perfectly on all devices
                                </p>
                            </div>
                        </div>
                        <div class="feature-item mb-3">
                            <i class="fas fa-shield-alt text-secondary me-3"></i>
                            <div>
                                <h6 style="color: white; margin-bottom: 0.5rem;">Safe & Secure</h6>
                                <p style="color: rgba(255, 255, 255, 0.7); margin: 0; font-size: 0.9rem;">
                                    No registration or personal data required
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .feature-item {
        display: flex;
        align-items: flex-start;
    }
    
    .feature-item i {
        font-size: 1.25rem;
        margin-top: 0.25rem;
    }
</style>

<script>
// Debug function to test if video analysis is working
function testAnalysis() {
    console.log('Testing video analysis...');
    const testUrl = 'https://www.youtube.com/watch?v=dQw4w9WgXcQ';
    fetch('/get_video_info', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ url: testUrl })
    })
    .then(response => response.json())
    .then(data => {
        console.log('Test analysis result:', data);
    })
    .catch(error => {
        console.error('Test analysis error:', error);
    });
}

// Enhanced tab hover effects
document.addEventListener('DOMContentLoaded', function() {
    const platformTabs = document.querySelectorAll('.nav-tabs .nav-link');
    platformTabs.forEach(tab => {
        tab.addEventListener('mouseenter', function() {
            if (!this.classList.contains('active')) {
                this.style.transform = 'translateY(-2px)';
            }
        });
        
        tab.addEventListener('mouseleave', function() {
            if (!this.classList.contains('active')) {
                this.style.transform = '';
            }
        });
    });
});

// Add test button for debugging
window.addEventListener('DOMContentLoaded', () => {
    setTimeout(() => {
        console.log('Page loaded, adding debug test...');
        // You can call testAnalysis() in console to test
        window.testAnalysis = testAnalysis;
    }, 1000);
});
</script>
{% endblock %}
